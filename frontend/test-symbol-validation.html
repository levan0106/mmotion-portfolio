<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Symbol Validation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .error { color: red; }
        .success { color: green; }
        button { padding: 10px 15px; margin: 5px; }
        input { padding: 8px; margin: 5px; width: 200px; }
    </style>
</head>
<body>
    <h1>Test Symbol Validation</h1>
    
    <div class="test-section">
        <h3>Test 1: Check existing symbol</h3>
        <input type="text" id="symbol1" placeholder="Enter symbol to check" value="VESAF">
        <button onclick="checkSymbol('symbol1')">Check Symbol</button>
        <div id="result1"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 2: Check non-existing symbol</h3>
        <input type="text" id="symbol2" placeholder="Enter symbol to check" value="NEWSYMBOL123">
        <button onclick="checkSymbol('symbol2')">Check Symbol</button>
        <div id="result2"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 3: Create asset with existing symbol</h3>
        <input type="text" id="symbol3" placeholder="Enter symbol" value="VESAF">
        <button onclick="createAsset('symbol3')">Create Asset</button>
        <div id="result3"></div>
    </div>

    <script>
        const accountId = '86c2ae61-8f69-4608-a5fd-8fecb44ed2c5';
        
        async function checkSymbol(inputId) {
            const symbol = document.getElementById(inputId).value;
            const resultId = inputId.replace('symbol', 'result');
            const resultDiv = document.getElementById(resultId);
            
            try {
                resultDiv.innerHTML = 'Checking...';
                
                const response = await fetch(`http://localhost:3000/api/v1/assets?symbol=${encodeURIComponent(symbol)}&createdBy=${accountId}`);
                const data = await response.json();
                
                if (response.ok) {
                    const assets = data.data || data;
                    const exists = Array.isArray(assets) && assets.length > 0;
                    
                    if (exists) {
                        resultDiv.innerHTML = `<span class="error">❌ Symbol '${symbol}' already exists</span>`;
                    } else {
                        resultDiv.innerHTML = `<span class="success">✅ Symbol '${symbol}' is available</span>`;
                    }
                } else {
                    resultDiv.innerHTML = `<span class="error">❌ Error: ${data.message || 'Unknown error'}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">❌ Network error: ${error.message}</span>`;
            }
        }
        
        async function createAsset(inputId) {
            const symbol = document.getElementById(inputId).value;
            const resultId = inputId.replace('symbol', 'result');
            const resultDiv = document.getElementById(resultId);
            
            try {
                resultDiv.innerHTML = 'Creating...';
                
                const assetData = {
                    name: `Test Asset ${symbol}`,
                    symbol: symbol,
                    type: 'STOCK',
                    description: 'Test asset for validation',
                    createdBy: accountId,
                    updatedBy: accountId
                };
                
                const response = await fetch('http://localhost:3000/api/v1/assets', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(assetData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<span class="success">✅ Asset created successfully: ${data.name}</span>`;
                } else {
                    resultDiv.innerHTML = `<span class="error">❌ Error: ${data.message || 'Unknown error'}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">❌ Network error: ${error.message}</span>`;
            }
        }
    </script>
</body>
</html>
